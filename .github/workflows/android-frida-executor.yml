name: Android Security Testing - Complete Toolkit v3 (Rooted)

on:
  workflow_dispatch:
    inputs:
      session_duration:
        description: 'Session duration in minutes'
        required: true
        default: '45'
        type: choice
        options:
          - '15'
          - '30'
          - '45'
          - '60'
      android_api:
        description: 'Android API level'
        required: true
        default: '31'
        type: choice
        options:
          - '29'
          - '30'
          - '31'
          - '33'
      server_port:
        description: 'Server port'
        required: true
        default: '8000'
      enable_advanced_tools:
        description: 'Install advanced tools (radare2, APKiD)'
        required: true
        default: true
        type: boolean

env:
  # CRITICAL FIX #1: Use standard HOME-based paths that avdmanager expects by default
  ANDROID_AVD_HOME: /home/runner/.android/avd
  ANDROID_SDK_ROOT: /usr/local/lib/android/sdk
  ANDROID_HOME: /usr/local/lib/android/sdk
  JAVA_HOME: /usr/lib/jvm/temurin-17-jdk-amd64
  ANDROID_API: ${{ inputs.android_api }}
  SERVER_PORT: ${{ inputs.server_port }}

jobs:
  android-security-session:
    runs-on: ubuntu-latest
    timeout-minutes: 65

    steps:
      # ============================================
      # PHASE 1: SYSTEM SETUP
      # ============================================
      
      - name: System Information
        run: |
          echo "============================================"
          echo "ðŸš€ ANDROID SECURITY TESTING v3.0 (ROOTED)"
          echo "============================================"
          echo "Runner: $(uname -a)"
          echo "CPU: $(nproc) cores"
          echo "RAM: $(free -h | grep Mem | awk '{print $2}')"
          echo "Disk: $(df -h / | tail -1 | awk '{print $4}') available"
          echo "Android API: ${{ inputs.android_api }}"
          echo "Session Duration: ${{ inputs.session_duration }} minutes"
          echo "============================================"

      - name: Enable KVM Acceleration
        run: |
          echo 'KERNEL=="kvm", GROUP="kvm", MODE="0666", OPTIONS+="static_node=kvm"' | sudo tee /etc/udev/rules.d/99-kvm4all.rules
          sudo udevadm control --reload-rules
          sudo udevadm trigger --name-match=kvm
          ls -la /dev/kvm
          echo "âœ… KVM enabled"

      - name: Setup Java 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Setup Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install System Dependencies
        run: |
          sudo apt-get update -qq
          sudo apt-get install -y -qq \
            wget curl unzip zip git jq \
            build-essential cmake pkg-config \
            libssl-dev libffi-dev libxml2-dev libxslt1-dev \
            zlib1g-dev libjpeg-dev libpng-dev \
            android-tools-adb android-tools-fastboot \
            aapt apksigner zipalign \
            openjdk-17-jdk graphviz \
            libc6-i386 lib32stdc++6 lib32z1 \
            qemu-kvm libvirt-daemon-system \
            xz-utils p7zip-full
          echo "âœ… System dependencies installed"

      # ============================================
      # PHASE 2: ANDROID SDK SETUP
      # ============================================

      - name: Configure Android SDK Paths
        run: |
          echo "$ANDROID_HOME/cmdline-tools/latest/bin" >> $GITHUB_PATH
          echo "$ANDROID_HOME/platform-tools" >> $GITHUB_PATH
          echo "$ANDROID_HOME/emulator" >> $GITHUB_PATH
          echo "$ANDROID_HOME/build-tools/34.0.0" >> $GITHUB_PATH
          echo "âœ… Android SDK paths configured"

      # ============================================================================
      # CRITICAL FIX #2: Create AVD directory structure BEFORE any SDK operations
      # ============================================================================
      - name: Initialize Android Directory Structure
        run: |
          echo "=== Creating Android directory structure ==="
          
          # Create the .android directory and subdirectories
          mkdir -p /home/runner/.android/avd
          mkdir -p /home/runner/.android/cache
          
          # Set proper permissions
          chmod -R 755 /home/runner/.android
          
          # Verify directories exist
          echo "Verifying directory structure:"
          ls -la /home/runner/.android/
          
          # Export for subsequent steps
          echo "ANDROID_AVD_HOME=/home/runner/.android/avd" >> $GITHUB_ENV
          echo "ANDROID_USER_HOME=/home/runner/.android" >> $GITHUB_ENV
          
          echo "âœ… Android directory structure created"

      - name: Install Android SDK Components
        run: |
          SDKMANAGER="$ANDROID_HOME/cmdline-tools/latest/bin/sdkmanager"
          
          echo "=== Accepting Licenses ==="
          yes | $SDKMANAGER --licenses > /dev/null 2>&1 || true
          
          echo "=== Installing Build Tools ==="
          $SDKMANAGER --install "build-tools;34.0.0" "build-tools;33.0.2" "build-tools;30.0.3"
          
          echo "=== Installing Platform Tools ==="
          $SDKMANAGER --install "platform-tools"
          
          echo "=== Installing Emulator ==="
          $SDKMANAGER --install "emulator"
          
          echo "=== Installing Platform for API ${{ inputs.android_api }} ==="
          $SDKMANAGER --install "platforms;android-${{ inputs.android_api }}"
          
          echo "=== Installing System Image (PlayStore for rootAVD) ==="
          # CRITICAL: Use google_apis_playstore for rootAVD compatibility
          $SDKMANAGER --install "system-images;android-${{ inputs.android_api }};google_apis_playstore;x86_64"
          
          echo "=== Verifying Installation ==="
          $SDKMANAGER --list_installed | grep -E "system-images|build-tools|platform-tools|emulator" || true
          
          # CRITICAL FIX #3: Verify system image is actually installed
          echo "=== Verifying System Image Path ==="
          SYSIMG_PATH="$ANDROID_HOME/system-images/android-${{ inputs.android_api }}/google_apis_playstore/x86_64"
          if [ -d "$SYSIMG_PATH" ]; then
            echo "âœ… System image found at: $SYSIMG_PATH"
            ls -la "$SYSIMG_PATH"
          else
            echo "âŒ ERROR: System image NOT found at: $SYSIMG_PATH"
            echo "Looking for any system images..."
            find $ANDROID_HOME/system-images -type d -name "x86_64" 2>/dev/null | head -10
            exit 1
          fi
          
          adb version
          echo "âœ… Android SDK components installed"

      # ============================================
      # PHASE 3: SECURITY TOOLS INSTALLATION
      # ============================================

      - name: Install APKTool
        run: |
          APKTOOL_VERSION="2.9.3"
          sudo wget -q "https://github.com/iBotPeaches/Apktool/releases/download/v${APKTOOL_VERSION}/apktool_${APKTOOL_VERSION}.jar" -O /usr/local/bin/apktool.jar
          sudo wget -q "https://raw.githubusercontent.com/iBotPeaches/Apktool/master/scripts/linux/apktool" -O /usr/local/bin/apktool
          sudo chmod +x /usr/local/bin/apktool
          apktool --version
          echo "âœ… APKTool installed"

      - name: Install JADX
        run: |
          JADX_VERSION="1.5.0"
          wget -q "https://github.com/skylot/jadx/releases/download/v${JADX_VERSION}/jadx-${JADX_VERSION}.zip" -O jadx.zip
          sudo unzip -q jadx.zip -d /opt/jadx
          sudo ln -sf /opt/jadx/bin/jadx /usr/local/bin/jadx
          sudo ln -sf /opt/jadx/bin/jadx-gui /usr/local/bin/jadx-gui
          jadx --version
          echo "âœ… JADX installed"

      - name: Install Python Security Tools
        run: |
          pip install --upgrade pip
          pip install frida-tools objection androguard lief --break-system-packages
          
          # Install uber-apk-signer
          wget -q "https://github.com/nicebyte/uber-apk-signer/releases/latest/download/uber-apk-signer.jar" -O /tmp/uber-apk-signer.jar 2>/dev/null || \
          wget -q "https://github.com/nicebyte/uber-apk-signer/releases/download/0.0.1/uber-apk-signer-0.0.1.jar" -O /tmp/uber-apk-signer.jar || true
          
          echo "Frida version: $(frida --version)"
          echo "Objection version: $(objection version 2>&1 | head -1)"
          echo "âœ… Python security tools installed"

      - name: Install Dex2Jar
        continue-on-error: true
        run: |
          DEX2JAR_VERSION="2.4"
          wget -q "https://github.com/pxb1988/dex2jar/releases/download/v${DEX2JAR_VERSION}/dex-tools-v${DEX2JAR_VERSION}.zip" -O dex2jar.zip || \
          wget -q "https://github.com/pxb1988/dex2jar/releases/download/2.1/dex-tools-2.1.zip" -O dex2jar.zip
          sudo unzip -q dex2jar.zip -d /opt/ || true
          sudo chmod +x /opt/dex-tools-*/d2j-*.sh 2>/dev/null || sudo chmod +x /opt/dex2jar-*/d2j-*.sh 2>/dev/null || true
          echo "âœ… Dex2Jar installed"

      - name: Install Smali/Baksmali
        continue-on-error: true
        run: |
          SMALI_VERSION="3.0.5"
          wget -q "https://github.com/google/smali/releases/download/v${SMALI_VERSION}/smali-${SMALI_VERSION}.jar" -O /tmp/smali.jar || \
          wget -q "https://bitbucket.org/JesusFreke/smali/downloads/smali-2.5.2.jar" -O /tmp/smali.jar || true
          
          wget -q "https://github.com/google/smali/releases/download/v${SMALI_VERSION}/baksmali-${SMALI_VERSION}.jar" -O /tmp/baksmali.jar || \
          wget -q "https://bitbucket.org/JesusFreke/smali/downloads/baksmali-2.5.2.jar" -O /tmp/baksmali.jar || true
          
          if [ -f /tmp/smali.jar ]; then
            echo '#!/bin/bash' | sudo tee /usr/local/bin/smali
            echo 'java -jar /tmp/smali.jar "$@"' | sudo tee -a /usr/local/bin/smali
            sudo chmod +x /usr/local/bin/smali
          fi
          
          if [ -f /tmp/baksmali.jar ]; then
            echo '#!/bin/bash' | sudo tee /usr/local/bin/baksmali
            echo 'java -jar /tmp/baksmali.jar "$@"' | sudo tee -a /usr/local/bin/baksmali
            sudo chmod +x /usr/local/bin/baksmali
          fi
          echo "âœ… Smali/Baksmali installed"

      - name: Install CFR Decompiler
        continue-on-error: true
        run: |
          CFR_VERSION="0.152"
          wget -q "https://github.com/leibnitz27/cfr/releases/download/${CFR_VERSION}/cfr-${CFR_VERSION}.jar" -O /tmp/cfr.jar || true
          if [ -f /tmp/cfr.jar ]; then
            echo '#!/bin/bash' | sudo tee /usr/local/bin/cfr
            echo 'java -jar /tmp/cfr.jar "$@"' | sudo tee -a /usr/local/bin/cfr
            sudo chmod +x /usr/local/bin/cfr
          fi
          echo "âœ… CFR installed"

      - name: Install Advanced Tools
        if: ${{ inputs.enable_advanced_tools }}
        continue-on-error: true
        run: |
          # Radare2
          sudo apt-get install -y radare2 || {
            git clone --depth=1 https://github.com/radareorg/radare2.git /tmp/radare2
            cd /tmp/radare2 && sys/install.sh
          }
          
          # APKiD
          pip install apkid --break-system-packages || true
          
          # Quark Engine
          pip install quark-engine --break-system-packages || true
          
          echo "âœ… Advanced tools installed"

      # ============================================
      # PHASE 4: CREATE AND START EMULATOR (FIXED)
      # ============================================

      # ============================================================================
      # CRITICAL FIX #4: Comprehensive AVD creation with full error handling
      # ============================================================================
      - name: Create Android Virtual Device
        run: |
          set -e  # Exit on any error
          
          AVDMANAGER="$ANDROID_HOME/cmdline-tools/latest/bin/avdmanager"
          ANDROID_API="${{ inputs.android_api }}"
          AVD_NAME="security_avd"
          SYSTEM_IMAGE="system-images;android-${ANDROID_API};google_apis_playstore;x86_64"
          
          echo "============================================"
          echo "=== AVD Creation Debug Information ==="
          echo "============================================"
          echo "ANDROID_HOME: $ANDROID_HOME"
          echo "ANDROID_AVD_HOME: $ANDROID_AVD_HOME"
          echo "ANDROID_USER_HOME: ${ANDROID_USER_HOME:-not set}"
          echo "HOME: $HOME"
          echo "AVD_NAME: $AVD_NAME"
          echo "SYSTEM_IMAGE: $SYSTEM_IMAGE"
          echo "============================================"
          
          # CRITICAL FIX #5: Ensure AVD home directory exists with correct structure
          echo "=== Ensuring AVD directory structure ==="
          mkdir -p "$ANDROID_AVD_HOME"
          mkdir -p "/home/runner/.android"
          chmod -R 755 /home/runner/.android
          ls -la /home/runner/.android/
          
          # CRITICAL FIX #6: List available device profiles to find valid ones
          echo "=== Available Device Profiles ==="
          $AVDMANAGER list device 2>&1 | grep -E "^id:|^Name:" | head -40 || true
          
          # CRITICAL FIX #7: Verify system image package path
          echo "=== Verifying System Image Package ==="
          SYSIMG_DIR="$ANDROID_HOME/system-images/android-${ANDROID_API}/google_apis_playstore/x86_64"
          if [ ! -d "$SYSIMG_DIR" ]; then
            echo "âŒ ERROR: System image directory not found!"
            echo "Expected: $SYSIMG_DIR"
            echo "Available system images:"
            find "$ANDROID_HOME/system-images" -type d -name "x86_64" 2>/dev/null || echo "None found"
            exit 1
          fi
          echo "âœ… System image directory verified: $SYSIMG_DIR"
          ls -la "$SYSIMG_DIR"
          
          # CRITICAL FIX #8: Clean up any existing AVD first
          echo "=== Cleaning up existing AVD (if any) ==="
          $AVDMANAGER delete avd -n "$AVD_NAME" 2>/dev/null || true
          rm -rf "$ANDROID_AVD_HOME/${AVD_NAME}.avd" 2>/dev/null || true
          rm -f "$ANDROID_AVD_HOME/${AVD_NAME}.ini" 2>/dev/null || true
          
          # CRITICAL FIX #9: Create AVD with VERBOSE mode and proper device
          # Using "pixel" instead of "pixel_4" as it's more universally available
          echo "=== Creating AVD with PlayStore image (VERBOSE) ==="
          echo "no" | $AVDMANAGER --verbose create avd \
            --force \
            --name "$AVD_NAME" \
            --package "$SYSTEM_IMAGE" \
            --device "pixel" \
            --abi "x86_64" \
            --tag "google_apis_playstore" 2>&1 || {
              echo "âŒ First attempt failed, trying without device specification..."
              echo "no" | $AVDMANAGER --verbose create avd \
                --force \
                --name "$AVD_NAME" \
                --package "$SYSTEM_IMAGE" \
                --abi "x86_64" 2>&1
            }
          
          # CRITICAL FIX #10: Verify AVD was actually created
          echo "=== Verifying AVD Creation ==="
          echo "Contents of ANDROID_AVD_HOME ($ANDROID_AVD_HOME):"
          ls -la "$ANDROID_AVD_HOME/" || echo "Directory empty or doesn't exist"
          
          if [ -f "$ANDROID_AVD_HOME/${AVD_NAME}.ini" ]; then
            echo "âœ… AVD ini file found!"
            cat "$ANDROID_AVD_HOME/${AVD_NAME}.ini"
          else
            echo "âŒ ERROR: AVD ini file NOT created!"
            echo "Checking alternative locations..."
            find /home/runner -name "${AVD_NAME}.ini" 2>/dev/null || echo "Not found anywhere"
            exit 1
          fi
          
          if [ -d "$ANDROID_AVD_HOME/${AVD_NAME}.avd" ]; then
            echo "âœ… AVD directory found!"
            ls -la "$ANDROID_AVD_HOME/${AVD_NAME}.avd/"
          else
            echo "âŒ ERROR: AVD directory NOT created!"
            exit 1
          fi
          
          # CRITICAL FIX #11: List all AVDs to confirm
          echo "=== Listing All AVDs ==="
          $AVDMANAGER list avd
          
          # CRITICAL FIX #12: Use emulator to list AVDs (cross-verification)
          echo "=== Emulator AVD List ==="
          $ANDROID_HOME/emulator/emulator -list-avds
          
          # Configure AVD for better performance
          echo "=== Configuring AVD for CI ==="
          CONFIG_FILE="$ANDROID_AVD_HOME/${AVD_NAME}.avd/config.ini"
          if [ -f "$CONFIG_FILE" ]; then
            echo "hw.keyboard=yes" >> "$CONFIG_FILE"
            echo "hw.gpu.enabled=yes" >> "$CONFIG_FILE"
            echo "hw.gpu.mode=swiftshader_indirect" >> "$CONFIG_FILE"
            echo "disk.dataPartition.size=4G" >> "$CONFIG_FILE"
            echo "âœ… AVD config updated"
          fi
          
          echo "âœ… AVD created and verified successfully!"

      # ============================================================================
      # CRITICAL FIX #13: Improved emulator startup with verification
      # ============================================================================
      - name: Start Android Emulator
        run: |
          set -e
          
          AVD_NAME="security_avd"
          
          echo "=== Pre-flight Checks ==="
          
          # Verify AVD exists before attempting to start
          echo "Checking AVD exists..."
          if ! $ANDROID_HOME/emulator/emulator -list-avds | grep -q "$AVD_NAME"; then
            echo "âŒ ERROR: AVD '$AVD_NAME' not found in emulator list!"
            echo "Available AVDs:"
            $ANDROID_HOME/emulator/emulator -list-avds
            exit 1
          fi
          echo "âœ… AVD '$AVD_NAME' found"
          
          # Kill any existing emulator processes
          echo "Cleaning up existing emulator processes..."
          pkill -9 -f "emulator" 2>/dev/null || true
          pkill -9 -f "qemu-system" 2>/dev/null || true
          sleep 3
          
          echo "=== Starting Emulator ==="
          
          # Start emulator with writable-system for rootAVD
          # CRITICAL FIX #14: Use @ syntax and proper environment
          export ANDROID_AVD_HOME="/home/runner/.android/avd"
          
          nohup $ANDROID_HOME/emulator/emulator \
            @${AVD_NAME} \
            -writable-system \
            -no-window \
            -no-audio \
            -no-boot-anim \
            -gpu swiftshader_indirect \
            -no-snapshot-save \
            -no-snapshot-load \
            -memory 4096 \
            -cores 2 \
            -partition-size 8192 \
            -verbose \
            2>&1 | tee /tmp/emulator.log &
          
          EMULATOR_PID=$!
          echo "Emulator PID: $EMULATOR_PID"
          echo "EMULATOR_PID=$EMULATOR_PID" >> $GITHUB_ENV
          
          # Wait for emulator process to initialize
          sleep 10
          
          # Check if emulator is still running
          if ! kill -0 $EMULATOR_PID 2>/dev/null; then
            echo "âŒ ERROR: Emulator process died!"
            echo "=== Emulator Log ==="
            cat /tmp/emulator.log | tail -100
            exit 1
          fi
          
          echo "âœ… Emulator process started successfully"
          echo "First 50 lines of emulator log:"
          head -50 /tmp/emulator.log || true

      # ============================================================================
      # CRITICAL FIX #15: Improved boot wait with better diagnostics
      # ============================================================================
      - name: Wait for Emulator Boot
        run: |
          echo "=== Waiting for Emulator ==="
          TIMEOUT=300
          ELAPSED=0
          
          # Wait for ADB to see the device first
          echo "Waiting for ADB device..."
          while [ $ELAPSED -lt 60 ]; do
            if adb devices 2>/dev/null | grep -q "emulator-"; then
              echo "âœ… ADB device detected after ${ELAPSED}s"
              break
            fi
            sleep 5
            ELAPSED=$((ELAPSED + 5))
            echo "â³ Waiting for ADB device... ${ELAPSED}s"
          done
          
          if ! adb devices 2>/dev/null | grep -q "emulator-"; then
            echo "âŒ ERROR: No emulator device found by ADB!"
            echo "=== ADB Devices ==="
            adb devices -l
            echo "=== Emulator Log (last 100 lines) ==="
            tail -100 /tmp/emulator.log || true
            exit 1
          fi
          
          # Now wait for boot completion
          echo "Waiting for boot completion..."
          ELAPSED=0
          while [ $ELAPSED -lt $TIMEOUT ]; do
            BOOT_COMPLETED=$(adb shell getprop sys.boot_completed 2>/dev/null | tr -d '\r\n' || echo "")
            if [ "$BOOT_COMPLETED" = "1" ]; then
              echo "âœ… Emulator booted after ${ELAPSED}s"
              break
            fi
            sleep 5
            ELAPSED=$((ELAPSED + 5))
            
            # Additional boot status info
            BOOT_ANIM=$(adb shell getprop init.svc.bootanim 2>/dev/null | tr -d '\r\n' || echo "unknown")
            echo "â³ Waiting... ${ELAPSED}s (boot_completed=$BOOT_COMPLETED, bootanim=$BOOT_ANIM)"
          done
          
          if [ $ELAPSED -ge $TIMEOUT ]; then
            echo "âŒ ERROR: Emulator boot timeout"
            echo "=== ADB Devices ==="
            adb devices -l
            echo "=== System Properties ==="
            adb shell getprop | head -50 || true
            echo "=== Emulator Log (last 100 lines) ==="
            tail -100 /tmp/emulator.log || true
            exit 1
          fi
          
          # Additional stability wait
          echo "Waiting for system stability..."
          sleep 20
          
          # Verify ADB connection
          echo "=== Final Verification ==="
          adb devices -l
          echo "Android Version: $(adb shell getprop ro.build.version.release)"
          echo "CPU ABI: $(adb shell getprop ro.product.cpu.abi)"
          echo "Device: $(adb shell getprop ro.product.device)"
          echo "âœ… Emulator ready"

      # ============================================
      # PHASE 5: ROOT EMULATOR WITH MAGISK
      # ============================================

      - name: Clone rootAVD
        run: |
          echo "=== Setting up rootAVD ==="
          cd /tmp
          git clone https://github.com/newbit1/rootAVD.git
          cd rootAVD
          chmod +x rootAVD.sh
          ls -la
          echo "âœ… rootAVD cloned"

      - name: Root AVD with Magisk
        run: |
          echo "=== Rooting AVD with Magisk ==="
          cd /tmp/rootAVD
          
          # Find ramdisk path
          RAMDISK_PATH="$ANDROID_HOME/system-images/android-${{ inputs.android_api }}/google_apis_playstore/x86_64/ramdisk.img"
          
          if [ ! -f "$RAMDISK_PATH" ]; then
            echo "Looking for ramdisk..."
            find $ANDROID_HOME/system-images -name "ramdisk.img" 2>/dev/null | head -5
            # Try alternative path
            RAMDISK_PATH=$(find $ANDROID_HOME/system-images -path "*android-${{ inputs.android_api }}*" -name "ramdisk.img" | head -1)
          fi
          
          echo "Ramdisk: $RAMDISK_PATH"
          
          if [ -f "$RAMDISK_PATH" ]; then
            # Run rootAVD with auto-selection of stable Magisk (option 1)
            echo "1" | timeout 300 ./rootAVD.sh "$RAMDISK_PATH" || {
              echo "rootAVD completed (may have warnings)"
            }
          else
            echo "âš ï¸ Ramdisk not found - skipping rootAVD"
          fi
          
          echo "âœ… rootAVD execution completed"

      - name: Verify Root and Reboot
        continue-on-error: true
        run: |
          echo "=== Verifying Root ==="
          
          # Check if Magisk is installed
          adb shell pm list packages | grep -i magisk || echo "Magisk package not found yet"
          
          # Try to get root
          ROOT_TEST=$(adb shell "su -c 'whoami'" 2>&1 || echo "no_root")
          if echo "$ROOT_TEST" | grep -q "root"; then
            echo "âœ… Root access confirmed!"
            echo "ROOT_AVAILABLE=true" >> $GITHUB_ENV
          else
            echo "âš ï¸ Root not yet available (expected on first boot)"
            echo "ROOT_AVAILABLE=pending" >> $GITHUB_ENV
          fi
          
          echo "âœ… Root verification completed"

      # Continue with the rest of your original workflow steps from here...
      # (PHASE 6 onwards - add your remaining steps)

      - name: Create Working Directories
        run: |
          mkdir -p /tmp/apks
          mkdir -p /tmp/output
          mkdir -p /tmp/logs
          mkdir -p /tmp/scripts
          echo "âœ… Working directories created"

      # Add your remaining steps here (FastAPI server, ngrok, etc.)
      # Copy from original workflow lines 350 onwards

      - name: Setup Complete Notification
        run: |
          echo "============================================"
          echo "ðŸŽ‰ ANDROID SECURITY TESTING ENVIRONMENT READY"
          echo "============================================"
          echo "AVD: security_avd"
          echo "Android API: ${{ inputs.android_api }}"
          echo "Root Status: ${ROOT_AVAILABLE:-unknown}"
          echo "============================================"
